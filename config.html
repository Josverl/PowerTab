<!DOCTYPE html>
<html lang="en">
<head>
    <script src='https://statics.teams.cdn.office.net/sdk/v1.5.2/js/MicrosoftTeams.min.js'></script>
</head>
        
    <body>



        
        <button onclick="(document.getElementById('icon').src = '/_PowerApps.png'); colorClickGray()">
            Select Gray</button>

        <img id="icon" src="/_Teams.png" alt="icon" style="width:100px" />
        <!-- <button onclick="(document.getElementById('icon').src = '/_PowerApps.png'); colorClickRed()">
            Select Red</button> -->

        <script>
            // var idTenant = "tenantId=2366459a-788c-49bd-92b6-b8700cf6ec17&"
            var idPowerApp = "a20ed0d5-e948-4c03-8e9d-1f9e2f3c93b7";
            let getUrl = (idPowerApp, isTab, addContext) => {
                var tabUrl = "https://apps.powerapps.com/play/providers/Microsoft.PowerApps/apps/" + idPowerApp	
                var ctxParams = "&teamId={teamId}&channelId={channelId}&upn={userPrincipalName}&loginHint={loginHint}&tenantId={tid}&theme={theme}&tid={tid}"
                 ctxParams +="&test={teamName}%20-%20{channelName}";

                // OK "teamId": "The Microsoft Teams ID in the format 19:[id]@thread.skype",
                // OK "teamName": "The name of the current team",
                // OK "channelId": "The channel ID in the format 19:[id]@thread.skype",
                // "channelName": "The name of the current channel",
                // "chatId": "The chat ID in the in the format 19:[id]@thread.skype",
                // "locale": "The current locale of the user formatted as languageId-countryId (for example, en-us)",
                // "entityId": "The developer-defined unique ID for the entity this content points to",
                // "subEntityId": "The developer-defined unique ID for the sub-entity this content points to",
                // "loginHint": "A value suitable as a login hint for Azure AD. This is usually the login name of the current user, in their home tenant",
                // "userPrincipalName": "The User Principal Name of the current user, in the current tenant",
                // "userObjectId": "The Azure AD object id of the current user, in the current tenant",
                // "tid": "The Azure AD tenant ID of the current user",
                // "groupId": "Guid identifying the current O365 Group ID",
                // "theme": "The current UI theme: default | dark | contrast",
                // "isFullScreen": "Indicates whether the tab is in full-screen mode",
                // "userLicenseType": "Indicates the user licence type in the given SKU (for example, student or teacher)",
                // "tenantSKU": "Indicates the SKU category of the tenant (for example, EDU)",
                // "channelType": "microsoftTeams.ChannelType.Private | microsoftTeams.ChannelType.Regular"



                if (isTab = true) {
                    tabUrl += "?source=teamstab"  + ctxParams ;
                } 
                // else {
                //     tabUrl += "?source=teamsweb";
                // }
                return tabUrl
            }


            console.log( "Teams.initialize()" );
            microsoftTeams.initialize();
            let saveGray = () => {
                console.log( "set OnSave" );
                microsoftTeams.settings.registerOnSaveHandler((saveEvent) => {
                    console.log( "set config :" + getUrl(idPowerApp, true)  );
                    microsoftTeams.settings.setSettings({
                        websiteUrl: getUrl(idPowerApp, false) ,
                        contentUrl: getUrl(idPowerApp, true) ,
                        entityId: idPowerApp,
                        suggestedDisplayName: "PowerTab"
                    });
                    console.log( "config saved" );
                    saveEvent.notifySuccess();
                    console.log( "ready to close" );
                });
            }

            // let saveRed = () => {
            //     microsoftTeams.settings.registerOnSaveHandler((saveEvent) => {
            //         microsoftTeams.settings.setSettings({
            //             websiteUrl: getUrl(idPowerApp, false) ,
            //             contentUrl: getUrl(idPowerApp, true) ,
            //             entityId: idPowerApp,
            //             suggestedDisplayName: "PowerTab"
            //         });
            //         saveEvent.notifySuccess();
            //     });
            // }

            // let gr = document.getElementById("gray").style;
            // let rd = document.getElementById("red").style;

            const colorClickGray = () => {
                // gr.display = "block";
                // rd.display = "none";
                console.log( "Ready to Save" );
                microsoftTeams.settings.setValidityState(true);
                saveGray()
            }

            // const colorClickRed = () => {
            //     // rd.display = "block";
            //     // gr.display = "none";
            //     console.log( "Ready to Save" );
            //     microsoftTeams.settings.setValidityState(true);
            //     saveRed();
            // }
        </script>
    </body>

</html>
